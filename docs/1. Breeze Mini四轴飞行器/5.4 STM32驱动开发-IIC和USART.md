title: 5.4 STM32驱动开发-IIC和USART

## 内容

讲解的这部分内容和代码在工程目录中的 **Drivers** 目录下的 **stm32f10x_driver_iic.c**、**stm32f10x_driver_iic.h**、**stm32f10x_driver_usart.c** 和 **stm32f10x_driver_usart.h** 中。

## IIC协议

### IIC简介

IC即 **Inter-Integrated Circuit**(集成电路总线）是一种简单、双向、二线制同步串行总线，这种总线协议是由飞利浦半导体在八十年代初设计出来的。IIC是一种多向控制总线，也就是说多个芯片可以连接到同一总线结构下，同时每个芯片都可以作为实时数据传输的控制源。IIC总线协议简单来说就是为了解决各大厂商众多产品之间相互通信问题所提出的一种统一的通信标准，大家都按照这个标准在自家产品中去实现，这样就可以很方便地在各个产品中传送数据了。

IIC总线由两根信号线组成，一个是双向数据线SDA，另一根线是时钟线SCL，所有接到IIC总线设备上上的串行数据SDA线都接到总线的SDA上，各个设备的时钟线SCL都接到总线的SCL上。

### IIC操作

#### 1. 总线空闲

SCL高电平，SDA高电平

#### 2. 起始位

SCL高电平，SDA出现下降沿

![breeze_embedded_iic_startbit](https://microdynamics-1256406063.cos.ap-shanghai.myqcloud.com/breeze/embedded/iic_startbit.png)

#### 3. 终止位

SCL高电平，SDA出现上升沿

![breeze_embedded_iic_endbit](https://microdynamics-1256406063.cos.ap-shanghai.myqcloud.com/breeze/embedded/iic_endbit.png)

#### 4. 数据传输

SCL低电平时SDA的高低电平变化，且SDA在SCL为高电平时不变换(因为此时SDA的状态挥别写入从机)

![breeze_embedded_iic_databits](https://microdynamics-1256406063.cos.ap-shanghai.myqcloud.com/breeze/embedded/iic_databits.png)

IIC的时钟线SCL最高频率：400K

应答：当IIC主机(可以是发送者也可以是接受者)将8位命令或数据传送出去后，会将SDA信号线设置为输入，并等待从机应答(等待SDA由高电平跳变为低电平)，若从机应答正确，则表明命令或数据传送成功，否则传送失败。**注意应答信号总是由数据接收方发给数据发送方的**。

IIC器件地址：每个支持IIC的外部器件都有一个IIC总线器件地址，这些器件地址有的在出厂时就已经设定好了，有的是只有部分位已经确定，未确定位可以通过在硬件设计上拉低或高某个管脚的电平来设置。比如EEPROM的前四位地址已经确定为1010，后三个地址则可以设置，这样在一个IIC总线上就可以支持最多挂载8个EEPROM。

#### 5. 传送包结构

以下是IIC总线协议传送的包结构图：

![breeze_embedded_iic_package_structure](https://microdynamics-1256406063.cos.ap-shanghai.myqcloud.com/breeze/embedded/iic_package_structure.png)


上图中开始信号之后的7位地址表示器件地址，第8位表示主机读或写位，0为写，1为读，接着是响应位。

#### 6. 字节读写时序

IIC器件单字节写时序为：

![breeze_embedded_iic_single_data_write](https://microdynamics-1256406063.cos.ap-shanghai.myqcloud.com/breeze/embedded/iic_single_data_write.png)

IIC器件的多字节写时序：

![breeze_embedded_iic_multi_data_write](https://microdynamics-1256406063.cos.ap-shanghai.myqcloud.com/breeze/embedded/iic_multi_data_write.png)

IIC器件单字节读时序(注意最后产生无应答信号)：

![breeze_embedded_iic_single_data_read](https://microdynamics-1256406063.cos.ap-shanghai.myqcloud.com/breeze/embedded/iic_single_data_read.png)

## USART

### USART简介

USART即 **Universal Synchronous Asynchronous Receiver/Transmitter**(通用同步异步串行接收/发送器)，

## 总结

## 参考

* [STM32开发指南-库函数版本_V3.1.pdf](https://documents-1256406063.cos.ap-shanghai.myqcloud.com/STM32F1%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E5%BA%93%E5%87%BD%E6%95%B0%E7%89%88%E6%9C%AC_V3.1%20.pdf), 正点原子, [ALLENTEK](http://www.alientek.com/).

* [IIC协议](https://www.cnblogs.com/bixiaopengblog/p/7469536.html)